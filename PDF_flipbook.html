<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PDF Flipbook</title>
<!-- PDF.js library -->
<script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
<style>
  /* ê¸°ë³¸ ë° í”Œë ‰ì„œë¸” ë””ìì¸, ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì ìš© */
  html, body {
    margin: 0; padding:0; height: 100%; width: 100%;
    overflow: hidden; font-family: 'Arial', sans-serif;
    background: #111;
  }
  #viewerContainer {
    width: 100%; height: 100%;
    position: relative;
    perspective: 1500px;
    overflow: hidden;
    display: flex;
    justify-content: center; align-items: center;
  }
  #pageWrapper {
    position: relative;
    width: 100%; height: 100%;
  }
  canvas {
    display: block;
    width: 100%; height: 100%;
    margin: auto;
    transition: transform 0.8s ease, opacity 0.8s ease;
    box-shadow: 0 0 40px rgba(0,0,0,0.3);
    background: #222;
  }
  /* ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ë¥¼ í†µí•´ ìŠ¬ë¼ì´ë“œ/í˜ì´ë“œ íš¨ê³¼ */
  .slideIn {
    animation: slideIn 0.8s forwards;
  }
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  /* í”Œë¡œíŒ… ë©”ë‰´ì™€ ì„¤ì • ì•„ì´ì½˜: ì˜¤ë¥¸ìª½ ìƒë‹¨ ìœ„ì¹˜ */
  #floatingMenu {
    position: fixed;
    top: 10px;
    right: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 1000;
  }
  .menu-btn {
    background: rgba(255,255,255,0.2);
    border: none; padding: 10px; border-radius: 50%;
    cursor: pointer; font-size: 20px; color: #fff;
    backdrop-filter: blur(4px);
    transition: background 0.3s;
  }
  .menu-btn:hover {
    background: rgba(255,255,255,0.4);
  }
  /* í˜ì´ì§€ í‘œì‹œì™€ ì•ˆë‚´ í…ìŠ¤íŠ¸ ê³ ì • ì˜ì—­ */
  #pageInfo {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(255,255,255,0.2);
    padding: 8px 12px;
    border-radius: 8px;
    color: #fff;
    font-size: 14px;
    font-weight: bold;
    white-space: nowrap; /* ë„ˆë¹„ ê³ ì •, ì¤„ë°”ê¿ˆ ì—†ìŒ */
    max-width: 120px;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>
</head>
<body>

<!-- PDF ë·°ì–´ ì˜ì—­ -->
<div id="viewerContainer">
  <div id="pageWrapper">
    <canvas id="pdfCanvas"></canvas>
  </div>
</div>

<!-- í”Œë¡œíŒ… ë©”ë‰´ -->
<div id="floatingMenu">
  <button class="menu-btn" id="btnFirst" title="ì²˜ìŒ í˜ì´ì§€">|&lt;</button>
  <button class="menu-btn" id="btnPrev" title="ì´ì „ í˜ì´ì§€">&lt;</button>
  <button class="menu-btn" id="btnNext" title="ë‹¤ìŒ í˜ì´ì§€">&gt;</button>
  <button class="menu-btn" id="btnEnd" title="ë í˜ì´ì§€">&gt;|</button>
  <button class="menu-btn" id="btnSinglePage" title="1ìª½ë³´ê¸°">1P</button>
  <button class="menu-btn" id="btnTwoPage" title="2ìª½ë³´ê¸°">2P</button>
  <button class="menu-btn" id="btnRotate" title="íšŒì „">â†»</button>
  <button class="menu-btn" id="btnReset" title="ì´ˆê¸°í™”">ğŸ”„</button>
  <!-- ì„¤ì • ì•„ì´ì½˜ -->
  <button class="menu-btn" id="btnSettings" title="ì„¤ì •" style="font-size:18px;">âš™ï¸</button>
</div>

<!-- í˜ì´ì§€ ì •ë³´ -->
<div id="pageInfo">0 / 0</div>

<!-- ë¹„ë°€ë²ˆí˜¸ Prompter (ì„¤ì •ì—ì„œ í˜¸ì¶œ) -->
<div id="passPrompt" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:2000; justify-content:center; align-items:center;">
  <div style="background:#fff; padding:20px; border-radius:8px; width:300px; max-width:80%; text-align:center;">
    <h3>ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h3>
    <input type="password" id="passwordInput" style="width:80%; padding:8px; font-size:16px;">
    <div style="margin-top:10px;">
      <button id="btnPasswordOk" style="padding:8px 16px;">í™•ì¸</button>
      <button id="btnPasswordCancel" style="padding:8px 16px;">ì·¨ì†Œ</button>
    </div>
  </div>
</div>

<!-- PDF URL ì €ì¥ -->
<script>
  // ê¸°ë³¸ê°’
  let pdfUrl = '';
  let pdfDoc = null;
  let currentPage = 1;
  let totalPage = 0;
  let scale = 1.0;
  let rotation = 0; // íšŒì „ ê°ë„
  let pagesPerView = 1; // 1 ë˜ëŠ” 2
  const maxScale = 2.0;
  const minScale = 0.5;
  const scaleStep = 0.2;

  // DOM ìºì‹œ
  const canvas = document.getElementById('pdfCanvas');
  const ctx = canvas.getContext('2d');
  const pageInfo = document.getElementById('pageInfo');

  // ë²„íŠ¼ ì—˜ë¦¬ë¨¼íŠ¸
  const btnFirst = document.getElementById('btnFirst');
  const btnPrev = document.getElementById('btnPrev');
  const btnNext = document.getElementById('btnNext');
  const btnEnd = document.getElementById('btnEnd');
  const btnSinglePage = document.getElementById('btnSinglePage');
  const btnTwoPage = document.getElementById('btnTwoPage');
  const btnRotate = document.getElementById('btnRotate');
  const btnReset = document.getElementById('btnReset');
  const btnSettings = document.getElementById('btnSettings');

  // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ í•¨ìˆ˜
  function animateTransition(type = 'slide') {
    // ìŠ¬ë¼ì´ë“œ ë˜ëŠ” í˜ì´ë“œ ì• ë‹ˆë©”ì´ì…˜
    // ê°„ë‹¨í•˜ê²Œ í˜ì´ë“œ ì¸ íš¨ê³¼
    ctx.globalAlpha = 0;
    const fadeIn = () => {
      ctx.globalAlpha += 0.1;
      if (ctx.globalAlpha >= 1) {
        ctx.globalAlpha = 1;
        cancelAnimationFrame(fadeInId);
      } else {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = ctx.globalAlpha;
        // ì¬ê·€ í˜¸ì¶œ
        fadeInId = requestAnimationFrame(fadeIn);
      }
    };
    let fadeInId = requestAnimationFrame(fadeIn);
  }

  // PDF ë Œë”ë§
  function renderPage(pageNum) {
    pdfDoc.getPage(pageNum).then(page => {
      const viewport = page.getViewport({ scale: scale, rotation: rotation });
      // canvas í¬ê¸° ì¡°ì ˆ
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      // ë Œë”ë§
      const renderContext = {
        canvasContext: ctx,
        viewport: viewport
      };
      page.render(renderContext).promise.then(() => {
        // ì• ë‹ˆë©”ì´ì…˜ ì ìš©
        animateTransition('slide');
        updatePageInfo();
      });
    });
  }

  function updatePageInfo() {
    pageInfo.textContent = `${currentPage} / ${totalPage}`;
  }

  // í˜ì´ì§€ ì´ë™ í•¨ìˆ˜
function goPage(pageNum) {
  if (pageNum < 1 || pageNum > totalPage) return;
  currentPage = pageNum;
  renderPage(currentPage);
}

// í˜ì´ì§€ ì „í™˜
btnFirst.onclick = () => goPage(1);
btnPrev.onclick = () => goPage(currentPage - 1);
btnNext.onclick = () => goPage(currentPage + 1);
btnEnd.onclick = () => goPage(totalPage);
btnSinglePage.onclick = () => {
  pagesPerView = 1; // 1í˜ì´ì§€ ë³´ê¸°
  // í•´ë‹¹í•˜ëŠ” ê¸°ëŠ¥
  // (ì´ ì½”ë“œì—ì„œëŠ” 1í˜ì´ì§€ë§Œ ë³´ì—¬ì¤Œ, ë˜ëŠ” í™”ë©´ íŒ¨ë„ì„ ë¹„ìš°ëŠ” ì‹ìœ¼ë¡œ)
  // êµ¬í˜„ ë“± ìƒëµ
};
btnTwoPage.onclick = () => {
  pagesPerView = 2; // 2í˜ì´ì§€ ë³´ê¸°
  // êµ¬í˜„ í•„ìš”
};
btnRotate.onclick = () => {
  rotation = (rotation + 90) % 360;
  renderPage(currentPage);
};
btnReset.onclick = () => {
  // ì´ˆê¸°í™”: ìƒˆ PDF ë¡œë“œ ë˜ëŠ” ë¦¬ì…‹
  if(pdfUrl) loadPdf(pdfUrl);
};

// PDF ë¡œë“œ í•¨ìˆ˜
function loadPdf(url) {
  pdfUrl = url;
  pdfjsLib.getDocument(url).promise.then(pdf => {
    pdfDoc = pdf;
    totalPage = pdf.numPages;
    currentPage = 1;
    renderPage(currentPage);
  });
}

// ì„¤ì • ì•„ì´ì½˜ í´ë¦­ ì‹œ
document.getElementById('btnSettings').onclick = () => {
  // ë¹„ë°€ë²ˆí˜¸ í”„ë¡œí”„íŠ¸ ë„ìš°ê¸°
  showPasswordPrompt();
};

// ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½
const passPrompt = document.getElementById('passPrompt');
const passwordInput = document.getElementById('passwordInput');

function showPasswordPrompt() {
  passwordInput.value = '';
  passPrompt.style.display = 'flex';
}
document.getElementById('btnPasswordOk').onclick = () => {
  const pw = passwordInput.value;
  if (pw === '1234') {
    // ì„±ê³µ -> ìƒˆ íƒ­ ë˜ëŠ” ì°½ ì—´ê¸°
    window.open('setting.html', '_blank');
  } else {
    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
  }
  passPrompt.style.display = 'none';
};
document.getElementById('btnPasswordCancel').onclick = () => {
  passPrompt.style.display = 'none';
};

// ì „ì²´ í™”ë©´ í„°ì¹˜ ë˜ëŠ” í´ë¦­ ë„¤ë¹„ê²Œì´ì…˜
canvas.onclick = (e) => {
  if(e.clientX > window.innerWidth/2) {
    // ì˜¤ë¥¸ìª½ í´ë¦­ -> ë‹¤ìŒ í˜ì´ì§€
    goPage(currentPage + 1);
  } else {
    // ì™¼ìª½ í´ë¦­ -> ì´ì „ í˜ì´ì§€
    goPage(currentPage - 1);
  }
};

// ì´ˆê¸° PDF URL ë¶ˆëŸ¬ì˜¤ê¸° (ì„¤ì •ì—ì„œ ì „ë‹¬ë°›ê±°ë‚˜ í˜„ì œ ìƒíƒœì—ì„œ í˜¸ì¶œ)
window.onload = () => {
  // ì˜ˆì œ: ì´ˆê¸°ê°’ ì—†ì„ ì‹œ ì•„ë¬´ê±°ë‚˜
  // loadPdf('sample.pdf');
};

</script>
</body>
</html>
