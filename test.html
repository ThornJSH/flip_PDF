<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
<title>PDF í”Œë¦½ë¶</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;overflow:hidden;font-family:'Sora',sans-serif;background:#000;color:#fff;}
.app{width:100%;height:100%;position:relative;}
/* === ì„¤ì • í™”ë©´ === */
#settingsScreen{display:none;overflow-y:auto;background:linear-gradient(135deg,#1a1a1a 0%,#2a2a2a 100%);color:#1a1a1a;min-height:100vh;}
.container{max-width:800px;margin:0 auto;padding:30px 20px;}
.header{text-align:center;margin-bottom:40px;}
.header h1{font-size:2em;color:#fff;margin-bottom:10px;}
.header p{color:#aaa;}
.card{background:#fff;border-radius:16px;padding:30px;margin-bottom:25px;box-shadow:0 10px 40px rgba(0,0,0,0.3);}
.section-title{font-size:1.3em;font-weight:700;color:#1a1a1a;margin-bottom:20px;}
.input-group{margin-bottom:20px;}
.input-label{display:block;font-weight:600;margin-bottom:8px;}
.input-field{width:100%;padding:14px 16px;border:2px solid #e0e0e0;border-radius:8px;font-size:0.95em;}
.input-field:focus{border-color:#7c3aed;outline:none;box-shadow:0 0 0 4px rgba(124,58,237,0.1);}
.examples{background:#f9f9f9;border-left:4px solid #7c3aed;padding:16px;border-radius:6px;margin-top:15px;}
.examples-title{color:#7c3aed;font-weight:600;margin-bottom:10px;}
.example-item{font-size:0.85em;color:#555;margin-bottom:8px;padding-left:16px;position:relative;}
.example-item::before{content:'â€¢';position:absolute;left:0;color:#7c3aed;}
.copy-btn{background:none;border:none;color:#7c3aed;cursor:pointer;font-size:0.85em;font-weight:600;text-decoration:underline;}
.button-group{display:flex;gap:12px;margin-top:30px;}
.btn{flex:1;padding:14px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;}
.btn-primary{background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);color:#fff;}
.btn-secondary{background:#f0f0f0;color:#1a1a1a;}
.status-message{margin-top:15px;padding:14px;border-radius:8px;display:none;}
.status-message.show{display:block;}
.status-success{background:#f0fdf4;color:#15803d;border:1px solid #bbf7d0;}
.status-error{background:#fff0f0;color:#d32f2f;border:1px solid #ffcdd2;}
.recent-item{background:#f9f9f9;padding:12px;border-radius:6px;border:1px solid #e0e0e0;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.recent-item-btn{background:none;border:none;color:#7c3aed;font-size:1.2em;cursor:pointer;}
/* === ë¡œë”© í™”ë©´ === */
#loadingScreen{display:none;flex-direction:column;justify-content:center;align-items:center;height:100%;background:linear-gradient(135deg,#1a1a1a 0%,#2a2a2a 100%);}
.loading-icon{font-size:5em;animation:bounce 2s infinite;}
@keyframes bounce{0%,100%{transform:translateY(0);}50%{transform:translateY(-20px);}}
.loading-text{margin-top:20px;color:#aaa;font-weight:500;}
.progress-container{width:300px;max-width:80%;background:#333;border-radius:12px;overflow:hidden;height:12px;margin-top:20px;}
.progress-bar{height:100%;width:0%;background:linear-gradient(90deg,#7c3aed,#6d28d9);transition:width 0.3s ease;}
.progress-percent{margin-top:10px;font-size:1em;color:#aaa;}
/* === ë·°ì–´ === */
#viewerScreen{display:none;width:100%;height:100%;background:#000;position:relative;}
.canvas{width:100%;height:100%;display:flex;justify-content:center;align-items:center;}
#flipbook{background:white;box-shadow:0 0 40px rgba(0,0,0,0.4);}
.page img{max-width:100%;max-height:100%;}
.floating-nav{position:fixed;top:24px;display:flex;gap:16px;z-index:20;}
.floating-nav.left{left:24px;} .floating-nav.right{right:24px;}
.nav-btn{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);color:white;border:none;cursor:pointer;}
.page-info{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,0.15);color:white;padding:10px 20px;border-radius:20px;}
.settings-btn{position:fixed;bottom:30px;right:30px;width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);color:white;border:none;font-size:1.4em;cursor:pointer;}
</style>
</head>
<body>
<div class="app">
  <!-- ì„¤ì • í™”ë©´ -->
  <div id="settingsScreen">
    <div class="container">
      <div class="header"><h1>âš™ï¸ PDF í”Œë¦½ë¶ ì„¤ì •</h1><p>PDF íŒŒì¼ì„ ë¡œë“œí•  URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”</p></div>
      <div class="card">
        <div class="section-title">ğŸ“ PDF URL ì…ë ¥</div>
        <div class="input-group">
          <label class="input-label">PDF íŒŒì¼ URL</label>
          <input type="text" id="pdfUrl" class="input-field" placeholder="https://example.com/document.pdf">
        </div>
        <div class="examples">
          <div class="examples-title">ğŸ“ URL ì˜ˆì‹œ</div>
          <div class="example-item">ì›¹ URL: <span>https://example.com/document.pdf</span> <button class="copy-btn" onclick="copyToClipboard('https://example.com/document.pdf')">ë³µì‚¬</button></div>
          <div class="example-item">ê¹ƒí—ˆë¸Œ Raw: <span>https://raw.githubusercontent.com/yourID/yourRepo/main/flip.pdf</span> <button class="copy-btn" onclick="copyToClipboard('https://raw.githubusercontent.com/yourID/yourRepo/main/flip.pdf')">ë³µì‚¬</button></div>
        </div>
        <div id="statusMessage" class="status-message"></div>
        <div class="button-group">
          <button class="btn btn-primary" onclick="savePdfUrl()">âœ“ ì €ì¥í•˜ê³  ë³´ê¸°</button>
        </div>
      </div>
      <div class="card">
        <div class="section-title">â±ï¸ ìµœê·¼ ì‚¬ìš©í•œ PDF</div>
        <div id="recentList"></div>
      </div>
    </div>
  </div>

  <!-- ë¡œë”© í™”ë©´ -->
  <div id="loadingScreen">
    <div class="loading-icon">ğŸ“„</div>
    <div class="loading-text">PDF ë¡œë”© ì¤‘...</div>
    <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
    <div class="progress-percent" id="progressPercent">0%</div>
  </div>

  <!-- ë·°ì–´ -->
  <div id="viewerScreen">
    <div class="floating-nav left"><button class="nav-btn" id="firstBtn">â®</button></div>
    <div class="canvas"><div id="flipbook"></div></div>
    <div class="floating-nav right"><button class="nav-btn" id="lastBtn">â­</button></div>
    <div class="page-info" id="pageInfo">0 / 0</div>
    <button class="settings-btn" onclick="showSettings()">âš™ï¸</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
let pdfDoc=null,isMobile=false,pdfOrientation='portrait',flipbookReady=false;
const progressBar=document.getElementById('progressBar');
const progressPercent=document.getElementById('progressPercent');

function detectDevice(){isMobile=/android|webos|iphone|ipad|ipod|blackberry|mobile|opera mini/i.test(navigator.userAgent.toLowerCase());}
function showSettings(){hideAll();document.getElementById('settingsScreen').style.display='block';displayRecent();}
function showLoading(){hideAll();document.getElementById('loadingScreen').style.display='flex';}
function showViewer(){hideAll();document.getElementById('viewerScreen').style.display='block';}
function hideAll(){document.querySelectorAll('#settingsScreen,#loadingScreen,#viewerScreen').forEach(e=>e.style.display='none');}

// âœ… ê¸°ë³¸ ì˜ˆì‹œ PDF (ê¹ƒí—ˆë¸Œ ê²½ë¡œ)
const DEFAULT_PDF = "https://raw.githubusercontent.com/yourID/yourRepo/main/flip.pdf";

function startApp(){
  const url = localStorage.getItem('pdfUrl');
  if(!url){
    // localStorageì— ì—†ìœ¼ë©´ ê¸°ë³¸ PDF ë¡œë“œ
    loadPDF(DEFAULT_PDF);
  }else{
    loadPDF(url);
  }
}

async function loadPDF(url){
  showLoading();
  try{
    const res=await fetch(url);
    if(!res.ok) throw new Error('PDFë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    const ab=await res.arrayBuffer();
    pdfDoc=await pdfjsLib.getDocument({data:ab}).promise;
    await analyzePDF();
    await renderProgressive();
  }catch(e){
    alert('ë¡œë“œ ì‹¤íŒ¨: '+e.message);
    showSettings();
  }
}

async function analyzePDF(){
  let landscape=0;
  for(let i=1;i<=Math.min(3,pdfDoc.numPages);i++){
    const p=await pdfDoc.getPage(i);const v=p.getViewport({scale:1});if(v.width>v.height)landscape++;
  }
  pdfOrientation=landscape>=2?'landscape':'portrait';
}

async function renderProgressive(){
  const flipbook=document.getElementById('flipbook');
  flipbook.innerHTML='';
  const total=pdfDoc.numPages;
  for(let i=1;i<=total;i++){
    const p=await pdfDoc.getPage(i);
    const v=p.getViewport({scale:2});
    const c=document.createElement('canvas');c.width=v.width;c.height=v.height;
    await p.render({canvasContext:c.getContext('2d'),viewport:v}).promise;
    const blob=await new Promise(r=>c.toBlob(r,'image/png'));
    const url=URL.createObjectURL(blob);
    const div=document.createElement('div');div.className='page';div.innerHTML=`<img src="${url}">`;
    flipbook.appendChild(div);
    updateProgress(i,total);
    if(i===1)initFlipbook();
  }
  showViewer();updatePage();
}

function updateProgress(i,t){const pct=Math.round(i/t*100);progressBar.style.width=pct+'%';progressPercent.textContent=pct+'%';}

function getOptimalSize(){
  let w,h,disp;
  if(isMobile){w=window.innerWidth;h=window.innerHeight;disp='single';}
  else{disp=pdfOrientation==='landscape'?'single':'double';w=Math.min(window.innerWidth*0.95,1200);h=Math.min(window.innerHeight*0.98,900);}
  return{width:w,height:h,display:disp};
}

function initFlipbook(){
  if($('#flipbook').turn('is'))return;
  const {width,height,display}=getOptimalSize();
  $('#flipbook').turn({width,height,display,autoCenter:true,duration:isMobile?500:1000,elevation:30,gradients:true,when:{turned:updatePage}});
  flipbookReady=true;
}
function updatePage(){if(!$('#flipbook').turn('is'))return;const c=$('#flipbook').turn('page');const t=$('#flipbook').turn('pages');document.getElementById('pageInfo').textContent=`${c} / ${t}`;}

document.getElementById('firstBtn').onclick=()=>$('#flipbook').turn('page',1);
document.getElementById('lastBtn').onclick=()=>$('#flipbook').turn('page',$('#flipbook').turn('pages'));

/* === ì„¤ì • ê¸°ëŠ¥ === */
function savePdfUrl(){
  const url=document.getElementById('pdfUrl').value.trim();
  if(!url.endsWith('.pdf'))return showStatus('ìœ íš¨í•œ PDF URLì„ ì…ë ¥í•˜ì„¸ìš”','error');
  localStorage.setItem('pdfUrl',url);addRecent(url);
  showStatus('âœ“ ì €ì¥ ì™„ë£Œ! ë¡œë“œ ì¤‘...','success');
  setTimeout(()=>loadPDF(url),800);
}
function showStatus(t,type){const m=document.getElementById('statusMessage');m.textContent=t;m.className=`status-message show status-${type}`;}
function addRecent(url){let arr=JSON.parse(localStorage.getItem('recentPdfs')||'[]');arr=arr.filter(x=>x!==url);arr.unshift(url);if(arr.length>10)arr=arr.slice(0,10);localStorage.setItem('recentPdfs',JSON.stringify(arr));}
function displayRecent(){const list=document.getElementById('recentList');list.innerHTML='';const arr=JSON.parse(localStorage.getItem('recentPdfs')||'[]');arr.forEach(u=>{const d=document.createElement('div');d.className='recent-item';d.innerHTML=`<span>${u}</span><button class='recent-item-btn' onclick="selectRecent('${u}')">â†—ï¸</button>`;list.appendChild(d);});}
function selectRecent(u){localStorage.setItem('pdfUrl',u);showStatus('âœ“ ìµœê·¼ PDF ë¡œë“œ ì¤‘...','success');setTimeout(()=>loadPDF(u),800);}
function copyToClipboard(t){navigator.clipboard.writeText(t).then(()=>alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'));}

window.addEventListener('resize',()=>{if(flipbookReady){const {width,height}=getOptimalSize();$('#flipbook').turn('size',width,height);}});
window.addEventListener('DOMContentLoaded',()=>{detectDevice();startApp();});
</script>
</body>
</html>
