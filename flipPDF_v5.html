<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D PDF Flipbook</title>
    <style>
        /* ì „ì—­ ë¦¬ì…‹ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #2a2a2a;
            color: #fff;
            touch-action: none;
        }

        /* ë¡œë”© í™”ë©´ */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-content {
            text-align: center;
            max-width: 80%;
        }

        .loading-title {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .progress-bar {
            width: 300px;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px auto;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .loading-text {
            font-size: 1.1em;
            margin-top: 10px;
            opacity: 0.9;
        }

        .credit-info {
            margin-top: 30px;
            font-size: 0.9em;
            opacity: 0.7;
            line-height: 1.6;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        #app-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* PDF ë·°ì–´ ì˜ì—­ */
        #viewer-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            perspective: 2000px;
            position: relative;
            background: #1a1a1a;
        }

        /* í˜ì´ì§€ ì»¨í…Œì´ë„ˆ */
        .page-wrapper {
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
        }

        .page-container {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
        }

        .pdf-page {
            background: white;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.645, 0.045, 0.355, 1);
        }

        .pdf-page.flipping {
            animation: flipPage 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
        }

        @keyframes flipPage {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0deg); }
        }

        /* í„°ì¹˜ ì˜ì—­ */
        .touch-area {
            position: absolute;
            top: 0;
            bottom: 50px;
            width: 50%;
            cursor: pointer;
            z-index: 10;
            transition: background-color 0.3s ease;
        }

        .touch-area:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .touch-area.left {
            left: 0;
        }

        .touch-area.right {
            right: 0;
        }

        /* ì»¨íŠ¸ë¡¤ë°” */
        #control-bar {
            height: 50px;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 15px;
            backdrop-filter: blur(10px);
        }

        /* í˜ì´ì§€ ìŠ¤í¬ë¡¤ë°” */
        #page-slider {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255,255,255,0.2);
            outline: none;
            border-radius: 3px;
        }

        #page-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #00d4ff;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0,212,255,0.5);
        }

        #page-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #00d4ff;
            cursor: pointer;
            border-radius: 50%;
            border: none;
            box-shadow: 0 2px 6px rgba(0,212,255,0.5);
        }

        #page-info {
            font-size: 0.9em;
            min-width: 80px;
            text-align: center;
        }

        /* ì„¤ì • ë²„íŠ¼ */
        #settings-btn {
            position: fixed;
            bottom: 70px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        #settings-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        /* ì„¤ì • íŒì—… */
        #settings-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        #settings-popup.active {
            display: flex;
        }

        .settings-content {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .settings-header h2 {
            font-size: 1.8em;
            color: #00d4ff;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #fff;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .close-btn:hover {
            opacity: 1;
        }

        .settings-section {
            margin-bottom: 25px;
        }

        .settings-section h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #00ff88;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .btn.active {
            background: linear-gradient(135deg, #00d4ff 0%, #00ff88 100%);
            color: #000;
            border-color: transparent;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        input[type="text"],
        input[type="number"] {
            flex: 1;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 1em;
        }

        input[type="file"] {
            display: none;
        }

        .file-upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .example-text {
            font-size: 0.85em;
            color: rgba(255,255,255,0.6);
            margin-top: 5px;
            line-height: 1.4;
        }

        .example-text code {
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }

        /* ì˜¤í”„ë¼ì¸ ì•Œë¦¼ */
        .offline-notice {
            background: rgba(255,149,0,0.2);
            border: 1px solid rgba(255,149,0,0.4);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .loading-title {
                font-size: 1.8em;
            }

            .progress-bar {
                width: 80%;
            }

            #settings-btn {
                width: 45px;
                height: 45px;
                font-size: 20px;
                bottom: 60px;
            }

            .settings-content {
                padding: 20px;
            }

            .settings-header h2 {
                font-size: 1.4em;
            }

            .btn {
                padding: 8px 16px;
                font-size: 0.9em;
            }
        }

        /* íšŒì „ ê°ì§€ */
        @media (orientation: landscape) {
            .page-container {
                max-width: 90%;
            }
        }

        @media (orientation: portrait) {
            .page-container {
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-title">ğŸ“š 3D PDF Flipbook</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="loading-text" id="loading-text">ì´ˆê¸°í™” ì¤‘...</div>
            <div class="credit-info">
                Perplexity AIë¥¼ í™œìš©í•´ welfareact.netì—ì„œ ì œì‘<br>
                ì €ì‘ê¶Œ ë¬¸ì œ ì—†ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì•± -->
    <div id="app-container" style="display: none;">
        <!-- PDF ë·°ì–´ -->
        <div id="viewer-container">
            <!-- ì¢Œì¸¡ í„°ì¹˜ ì˜ì—­ -->
            <div class="touch-area left" id="prev-area"></div>
            <!-- ìš°ì¸¡ í„°ì¹˜ ì˜ì—­ -->
            <div class="touch-area right" id="next-area"></div>
            <!-- í˜ì´ì§€ ë Œë”ë§ ì˜ì—­ -->
            <div class="page-wrapper" id="page-wrapper">
                <div class="page-container" id="page-container"></div>
            </div>
        </div>

        <!-- ì»¨íŠ¸ë¡¤ë°” -->
        <div id="control-bar">
            <div id="page-info">1 / 1</div>
            <input type="range" id="page-slider" min="1" max="1" value="1">
        </div>

        <!-- ì„¤ì • ë²„íŠ¼ -->
        <button id="settings-btn" title="ì„¤ì •">âš™ï¸</button>
    </div>

    <!-- ì„¤ì • íŒì—… -->
    <div id="settings-popup">
        <div class="settings-content">
            <div class="settings-header">
                <h2>âš™ï¸ ì„¤ì •</h2>
                <button class="close-btn" id="close-settings">&times;</button>
            </div>

            <!-- ë³´ê¸° ì„¤ì • -->
            <div class="settings-section">
                <h3>ğŸ“– ë³´ê¸° ì„¤ì •</h3>
                <div class="button-group">
                    <button class="btn active" id="single-page-btn">1ìª½ ë³´ê¸°</button>
                    <button class="btn" id="double-page-btn">2ìª½ ë³´ê¸°</button>
                    <button class="btn" id="rotate-btn">ğŸ”„ í™”ë©´ íšŒì „</button>
                </div>
            </div>

            <!-- í˜ì´ì§€ ì´ë™ -->
            <div class="settings-section">
                <h3>ğŸ“ í˜ì´ì§€ ì´ë™</h3>
                <div class="input-group">
                    <input type="number" id="goto-page" placeholder="í˜ì´ì§€ ë²ˆí˜¸" min="1">
                    <button class="btn" id="goto-btn">ì´ë™</button>
                </div>
            </div>

            <!-- PDF ë¶ˆëŸ¬ì˜¤ê¸° -->
            <div class="settings-section">
                <h3>ğŸ“‚ PDF ë¶ˆëŸ¬ì˜¤ê¸°</h3>
                
                <div class="input-group">
                    <input type="text" id="pdf-url" placeholder="PDF URL ì…ë ¥">
                    <button class="btn" id="load-url-btn">ë¡œë“œ</button>
                </div>
                
                <div class="example-text">
                    <strong>GitHub:</strong><br>
                    <code>https://raw.githubusercontent.com/[username]/[repo]/main/[file].pdf</code><br><br>
                    <strong>Google Drive:</strong><br>
                    <code>https://drive.google.com/uc?export=download&amp;id=[FILE_ID]</code>
                </div>

                <div style="margin-top: 15px;">
                    <label for="pdf-file" class="file-upload-btn">ğŸ“ íŒŒì¼ ì—…ë¡œë“œ</label>
                    <input type="file" id="pdf-file" accept=".pdf">
                </div>

                <div style="margin-top: 15px;">
                    <button class="btn" id="default-pdf-btn">ğŸ”„ ê¸°ë³¸ PDF ë¡œë“œ (flip.pdf)</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ì „ì—­ ë³€ìˆ˜ ë° ì„¤ì • ====================
        const CONFIG = {
            defaultPdfUrl: 'https://raw.githubusercontent.com/ThornJSH/flip_PDF/main/flip.pdf',
            pdfJsCdn: 'https://cdn.jsdelivr.net/npm/pdfjs-dist@4.2.292/build/pdf.min.js',
            workerCdn: 'https://cdn.jsdelivr.net/npm/pdfjs-dist@4.2.292/build/pdf.worker.min.js'
        };

        // ì•± ìƒíƒœ (localStorage ëŒ€ì‹  ë©”ëª¨ë¦¬ì— ì €ì¥)
        const AppState = {
            pdfDoc: null,
            currentPage: 1,
            totalPages: 0,
            viewMode: 'single', // 'single' or 'double'
            rotation: 0,
            isOnline: navigator.onLine,
            pdfLibLoaded: false
        };

        // ==================== PDF.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ====================
        async function loadPdfLibrary() {
            updateLoadingText('PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì¤‘...');
            updateProgress(10);

            try {
                // ì˜¨ë¼ì¸ ëª¨ë“œ: CDNì—ì„œ ë¡œë“œ
                if (AppState.isOnline) {
                    await loadScript(CONFIG.pdfJsCdn);
                    if (typeof pdfjsLib !== 'undefined') {
                        pdfjsLib.GlobalWorkerOptions.workerSrc = CONFIG.workerCdn;
                        AppState.pdfLibLoaded = true;
                        updateProgress(30);
                        return true;
                    }
                }
                
                // ì˜¤í”„ë¼ì¸ ëŒ€ì²´: ê°„ë‹¨í•œ PDF ë Œë”ë§ ì•Œë¦¼
                throw new Error('PDF.js ë¡œë“œ ì‹¤íŒ¨');
            } catch (error) {
                console.error('PDF.js ë¡œë”© ì˜¤ë¥˜:', error);
                showOfflineNotice();
                return false;
            }
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        function showOfflineNotice() {
            const notice = document.createElement('div');
            notice.className = 'offline-notice';
            notice.textContent = 'âš ï¸ ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤. ì˜¨ë¼ì¸ ì—°ê²° ì‹œ ë¹ ë¥¸ ë¡œë”©ì´ ì œê³µë©ë‹ˆë‹¤.';
            document.querySelector('.settings-content').prepend(notice);
        }

        // ==================== PDF ë¡œë”© ====================
        async function loadPDF(source) {
            try {
                updateLoadingText('PDF íŒŒì¼ ë¡œë”© ì¤‘...');
                updateProgress(40);
                showLoading();

                let pdfData;
                
                if (typeof source === 'string') {
                    // URLì—ì„œ ë¡œë“œ
                    const response = await fetch(source);
                    if (!response.ok) throw new Error('PDF ë¡œë“œ ì‹¤íŒ¨');
                    pdfData = await response.arrayBuffer();
                } else {
                    // íŒŒì¼ ê°ì²´ì—ì„œ ë¡œë“œ
                    pdfData = await source.arrayBuffer();
                }

                updateProgress(60);

                if (!AppState.pdfLibLoaded) {
                    alert('PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì˜¨ë¼ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    hideLoading();
                    return;
                }

                // PDF ë¬¸ì„œ ë¡œë“œ
                const loadingTask = pdfjsLib.getDocument({ data: pdfData });
                AppState.pdfDoc = await loadingTask.promise;
                AppState.totalPages = AppState.pdfDoc.numPages;
                AppState.currentPage = 1;

                updateProgress(80);

                // UI ì´ˆê¸°í™”
                initializeUI();
                await renderPages();

                updateProgress(100);
                setTimeout(hideLoading, 500);

            } catch (error) {
                console.error('PDF ë¡œë”© ì˜¤ë¥˜:', error);
                alert('PDFë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
                hideLoading();
            }
        }

        // ==================== í˜ì´ì§€ ë Œë”ë§ ====================
        async function renderPages() {
            const container = document.getElementById('page-container');
            container.innerHTML = '';

            try {
                if (AppState.viewMode === 'single') {
                    await renderPage(AppState.currentPage, container);
                } else {
                    // 2ìª½ ë³´ê¸°
                    const leftPage = AppState.currentPage;
                    const rightPage = AppState.currentPage + 1;
                    
                    if (leftPage <= AppState.totalPages) {
                        await renderPage(leftPage, container);
                    }
                    if (rightPage <= AppState.totalPages) {
                        await renderPage(rightPage, container);
                    }
                }
            } catch (error) {
                console.error('í˜ì´ì§€ ë Œë”ë§ ì˜¤ë¥˜:', error);
            }
        }

        async function renderPage(pageNum, container) {
            const page = await AppState.pdfDoc.getPage(pageNum);
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            // ë·°í¬íŠ¸ ê³„ì‚° (ê³ í™”ì§ˆ ë Œë”ë§)
            const viewport = page.getViewport({ scale: 1, rotation: AppState.rotation });
            const scale = calculateScale(viewport);
            const scaledViewport = page.getViewport({ scale: scale * window.devicePixelRatio, rotation: AppState.rotation });
            
            canvas.height = scaledViewport.height;
            canvas.width = scaledViewport.width;
            canvas.style.width = (scaledViewport.width / window.devicePixelRatio) + 'px';
            canvas.style.height = (scaledViewport.height / window.devicePixelRatio) + 'px';
            
            canvas.className = 'pdf-page';
            container.appendChild(canvas);

            // ë Œë”ë§
            const renderContext = {
                canvasContext: context,
                viewport: scaledViewport
            };
            
            await page.render(renderContext).promise;
        }

        function calculateScale(viewport) {
            const viewerContainer = document.getElementById('viewer-container');
            const containerWidth = viewerContainer.clientWidth;
            const containerHeight = viewerContainer.clientHeight - 20;
            
            let scale = 1;
            
            if (AppState.viewMode === 'single') {
                const widthScale = (containerWidth * 0.9) / viewport.width;
                const heightScale = (containerHeight * 0.9) / viewport.height;
                scale = Math.min(widthScale, heightScale);
            } else {
                const widthScale = (containerWidth * 0.85) / (viewport.width * 2 + 20);
                const heightScale = (containerHeight * 0.9) / viewport.height;
                scale = Math.min(widthScale, heightScale);
            }
            
            return scale;
        }

        // ==================== í˜ì´ì§€ ì „í™˜ (3D í”Œë¦½ íš¨ê³¼) ====================
        async function flipToPage(pageNum) {
            if (pageNum < 1 || pageNum > AppState.totalPages) return;
            if (pageNum === AppState.currentPage) return;

            // 3D í”Œë¦½ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
            const pages = document.querySelectorAll('.pdf-page');
            pages.forEach(page => page.classList.add('flipping'));

            // ì• ë‹ˆë©”ì´ì…˜ ì¤‘ê°„ì— í˜ì´ì§€ ë³€ê²½
            setTimeout(async () => {
                AppState.currentPage = pageNum;
                await renderPages();
                updatePageInfo();
            }, 400);

            // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ í´ë˜ìŠ¤ ì œê±°
            setTimeout(() => {
                const newPages = document.querySelectorAll('.pdf-page');
                newPages.forEach(page => page.classList.remove('flipping'));
            }, 800);
        }

        function nextPage() {
            const increment = AppState.viewMode === 'double' ? 2 : 1;
            flipToPage(AppState.currentPage + increment);
        }

        function prevPage() {
            const decrement = AppState.viewMode === 'double' ? 2 : 1;
            flipToPage(AppState.currentPage - decrement);
        }

        // ==================== UI ì´ˆê¸°í™” ë° ì—…ë°ì´íŠ¸ ====================
        function initializeUI() {
            const slider = document.getElementById('page-slider');
            slider.max = AppState.totalPages;
            slider.value = AppState.currentPage;
            updatePageInfo();
            
            document.getElementById('goto-page').max = AppState.totalPages;
            document.getElementById('app-container').style.display = 'flex';
        }

        function updatePageInfo() {
            const pageInfo = document.getElementById('page-info');
            if (AppState.viewMode === 'double') {
                const rightPage = Math.min(AppState.currentPage + 1, AppState.totalPages);
                pageInfo.textContent = `${AppState.currentPage}-${rightPage} / ${AppState.totalPages}`;
            } else {
                pageInfo.textContent = `${AppState.currentPage} / ${AppState.totalPages}`;
            }
            
            const slider = document.getElementById('page-slider');
            slider.value = AppState.currentPage;
        }

        function updateLoadingText(text) {
            document.getElementById('loading-text').textContent = text;
        }

        function updateProgress(percent) {
            document.getElementById('progress-fill').style.width = percent + '%';
        }

        function showLoading() {
            const loadingScreen = document.getElementById('loading-screen');
            loadingScreen.classList.remove('hidden');
            loadingScreen.style.display = 'flex';
        }

        function hideLoading() {
            const loadingScreen = document.getElementById('loading-screen');
            loadingScreen.classList.add('hidden');
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 500);
        }

        // ==================== ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ====================
        function setupEventListeners() {
            // í„°ì¹˜/í´ë¦­ìœ¼ë¡œ í˜ì´ì§€ ì „í™˜
            document.getElementById('prev-area').addEventListener('click', prevPage);
            document.getElementById('next-area').addEventListener('click', nextPage);

            // í„°ì¹˜ ìŠ¤ì™€ì´í”„ ê°ì§€
            let touchStartX = 0;
            let touchEndX = 0;
            const viewer = document.getElementById('viewer-container');

            viewer.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            });

            viewer.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });

            function handleSwipe() {
                const swipeThreshold = 50;
                if (touchEndX < touchStartX - swipeThreshold) {
                    nextPage();
                }
                if (touchEndX > touchStartX + swipeThreshold) {
                    prevPage();
                }
            }

            // í˜ì´ì§€ ìŠ¬ë¼ì´ë”
            const slider = document.getElementById('page-slider');
            slider.addEventListener('input', (e) => {
                flipToPage(parseInt(e.target.value));
            });

            // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') prevPage();
                if (e.key === 'ArrowRight') nextPage();
            });

            // ì„¤ì • ë²„íŠ¼
            document.getElementById('settings-btn').addEventListener('click', () => {
                document.getElementById('settings-popup').classList.add('active');
            });

            document.getElementById('close-settings').addEventListener('click', () => {
                document.getElementById('settings-popup').classList.remove('active');
            });

            // íŒì—… ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
            document.getElementById('settings-popup').addEventListener('click', (e) => {
                if (e.target.id === 'settings-popup') {
                    document.getElementById('settings-popup').classList.remove('active');
                }
            });

            // ë³´ê¸° ëª¨ë“œ ë³€ê²½
            document.getElementById('single-page-btn').addEventListener('click', async () => {
                AppState.viewMode = 'single';
                document.getElementById('single-page-btn').classList.add('active');
                document.getElementById('double-page-btn').classList.remove('active');
                await renderPages();
                updatePageInfo();
            });

            document.getElementById('double-page-btn').addEventListener('click', async () => {
                AppState.viewMode = 'double';
                document.getElementById('double-page-btn').classList.add('active');
                document.getElementById('single-page-btn').classList.remove('active');
                // ì§ìˆ˜ í˜ì´ì§€ë¡œ ì¡°ì •
                if (AppState.currentPage % 2 === 0) {
                    AppState.currentPage = Math.max(1, AppState.currentPage - 1);
                }
                await renderPages();
                updatePageInfo();
            });

            // í™”ë©´ íšŒì „
            document.getElementById('rotate-btn').addEventListener('click', async () => {
                AppState.rotation = (AppState.rotation + 90) % 360;
                await renderPages();
            });

            // í˜ì´ì§€ ì´ë™
            document.getElementById('goto-btn').addEventListener('click', () => {
                const pageNum = parseInt(document.getElementById('goto-page').value);
                if (pageNum >= 1 && pageNum <= AppState.totalPages) {
                    flipToPage(pageNum);
                    document.getElementById('settings-popup').classList.remove('active');
                }
            });

            // PDF URL ë¡œë“œ
            document.getElementById('load-url-btn').addEventListener('click', () => {
                const url = document.getElementById('pdf-url').value.trim();
                if (url) {
                    loadPDF(url);
                    document.getElementById('settings-popup').classList.remove('active');
                }
            });

            // íŒŒì¼ ì—…ë¡œë“œ
            document.getElementById('pdf-file').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    loadPDF(file);
                    document.getElementById('settings-popup').classList.remove('active');
                }
            });

            // ê¸°ë³¸ PDF ë¡œë“œ
            document.getElementById('default-pdf-btn').addEventListener('click', () => {
                loadPDF(CONFIG.defaultPdfUrl);
                document.getElementById('settings-popup').classList.remove('active');
            });

            // í™”ë©´ íšŒì „ ê°ì§€
            window.addEventListener('orientationchange', async () => {
                setTimeout(async () => {
                    await renderPages();
                }, 100);
            });

            // ë¦¬ì‚¬ì´ì¦ˆ ê°ì§€
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(async () => {
                    await renderPages();
                }, 250);
            });

            // ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ê°ì§€
            window.addEventListener('online', () => {
                AppState.isOnline = true;
                console.log('ì˜¨ë¼ì¸ ëª¨ë“œ');
            });

            window.addEventListener('offline', () => {
                AppState.isOnline = false;
                console.log('ì˜¤í”„ë¼ì¸ ëª¨ë“œ');
            });
        }

        // ==================== ì•± ì´ˆê¸°í™” ====================
        async function initializeApp() {
            try {
                updateLoadingText('ì•± ì´ˆê¸°í™” ì¤‘...');
                updateProgress(5);

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                setupEventListeners();

                // PDF.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
                const libLoaded = await loadPdfLibrary();
                
                if (!libLoaded) {
                    updateLoadingText('ì˜¤í”„ë¼ì¸ ëª¨ë“œ - PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    setTimeout(() => {
                        hideLoading();
                        alert('ì˜¨ë¼ì¸ ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.');
                    }, 2000);
                    return;
                }

                // ê¸°ë³¸ PDF ë¡œë“œ
                await loadPDF(CONFIG.defaultPdfUrl);

            } catch (error) {
                console.error('ì•± ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                updateLoadingText('ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message);
                setTimeout(hideLoading, 2000);
            }
        }

        // ì•± ì‹œì‘
        window.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>