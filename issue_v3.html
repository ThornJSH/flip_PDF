<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <title>PDF ÌîåÎ¶ΩÎ∂Å</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}
        html,body{width:100%;height:100%;overflow:hidden}
        body{font-family:'Sora',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#000;color:#1a1a1a}
        .app{display:flex;width:100%;height:100%}
        .loading-screen{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;background:linear-gradient(135deg,#1a1a1a 0%,#2a2a2a 100%)}
        .loading-content{text-align:center;max-width:400px;width:90%}
        .loading-icon{font-size:5em;margin-bottom:30px;animation:bounce 2s infinite}
        @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
        .loading-text{font-size:1.3em;color:#888;font-weight:500;margin-bottom:10px}
        .loading::after{content:'...';animation:dots 1.5s steps(4) infinite}
        @keyframes dots{0%,20%{content:'.'}40%{content:'..'}60%,100%{content:'...'}}
        .progress-container{margin:30px 0;display:flex;flex-direction:column;gap:16px}
        .progress-bar{width:100%;height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;box-shadow:inset 0 2px 4px rgba(0,0,0,0.3)}
        .progress-fill{height:100%;background:linear-gradient(90deg,#7c3aed 0%,#a855f7 100%);border-radius:4px;width:0%;transition:width 0.3s ease;box-shadow:0 0 16px rgba(124,58,237,0.6)}
        .progress-text{text-align:center;color:#aaa;font-size:0.95em;font-weight:600;letter-spacing:0.5px}
        .progress-status{text-align:center;color:#888;font-size:0.85em;margin-top:8px;min-height:20px}
        .loading-credit{font-size:.9em;color:#666;margin-top:40px;line-height:1.8}
        .loading-credit-title{font-size:.95em;color:#888;font-weight:600;margin-bottom:8px}
        .loading-credit-text{color:#666;font-size:.85em}
        .loading-credit-link{color:#7c3aed;text-decoration:none;font-weight:600;transition:all .3s}
        .loading-credit-link:hover{color:#a855f7;text-decoration:underline}
        .viewer-screen{display:none;flex-direction:column;width:100%;height:100%;background:#000;position:relative;overflow:hidden}
        .viewer-screen.show{display:flex}
        .top-progress-container{width:100%;height:6px;background:rgba(255,255,255,0.08);position:relative;cursor:pointer;user-select:none;flex-shrink:0}
        .top-progress-bar{height:100%;background:linear-gradient(90deg,#7c3aed 0%,#a855f7 100%);border-radius:0;width:0%;transition:width 0.1s linear;box-shadow:0 0 16px rgba(124,58,237,0.6);position:relative;display:flex;align-items:center;justify-content:flex-end}
        .top-progress-handle{position:relative;width:14px;height:14px;background:white;border-radius:50%;transform:translateX(50%);cursor:grab;box-shadow:0 2px 8px rgba(124,58,237,0.5);transition:all 0.2s;flex-shrink:0}
        .top-progress-handle:active{cursor:grabbing;transform:translateX(50%) scale(1.4);box-shadow:0 4px 12px rgba(124,58,237,0.8)}
        .top-progress-handle:hover{transform:translateX(50%) scale(1.15)}
        .canvas{width:100%;height:100%;display:flex;justify-content:center;align-items:center;overflow:hidden;background:#000;position:relative;flex:1}
        #flipbook{background:white;box-shadow:0 0 40px rgba(0,0,0,0.4);overflow:hidden;max-width:100%;max-height:100%}
        .page{background:white;display:flex!important;justify-content:center;align-items:center;overflow:hidden}
        .page img{max-width:100%;max-height:100%;object-fit:contain;pointer-events:none}
        .touch-zone{position:absolute;height:100%;top:0;cursor:pointer;z-index:5}
        .touch-zone-left{left:0;width:30%}
        .touch-zone-right{right:0;width:30%}
        .touch-zone:hover{background:rgba(255,255,255,0.01)}
        .page-info{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,0.15);color:white;padding:12px 24px;border-radius:24px;font-size:.95em;font-weight:600;backdrop-filter:blur(10px);z-index:10;pointer-events:none}
        .floating-nav{position:fixed;top:24px;display:flex;gap:16px;z-index:20}
        .floating-nav.left{left:24px}
        .floating-nav.right{right:24px}
        .nav-btn{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);color:white;border:none;cursor:pointer;font-size:1.3em;transition:all .3s;box-shadow:0 8px 24px rgba(124,58,237,0.3);display:flex;align-items:center;justify-content:center;backdrop-filter:blur(10px)}
        .nav-btn:hover{transform:translateY(-3px);box-shadow:0 12px 32px rgba(124,58,237,0.4)}
        .nav-btn:active{transform:translateY(-1px)}
        .nav-btn:disabled{opacity:.4;cursor:not-allowed;box-shadow:0 4px 12px rgba(124,58,237,0.2)}
        .settings-btn{position:fixed;bottom:30px;right:30px;width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);color:white;border:none;cursor:pointer;font-size:1.5em;transition:all .3s;box-shadow:0 8px 24px rgba(124,58,237,0.3);display:flex;align-items:center;justify-content:center;z-index:20}
        .settings-btn:hover{transform:scale(1.1);box-shadow:0 12px 32px rgba(124,58,237,0.4)}
        .settings-btn:active{transform:scale(1.05)}
        @media (max-width:768px){
            .nav-btn{width:44px;height:44px;font-size:1.1em}
            .page-info{bottom:20px;padding:10px 20px;font-size:.85em}
            .settings-btn{bottom:20px;right:20px;width:50px;height:50px;font-size:1.2em}
            .loading-icon{font-size:4em}
            .loading-text{font-size:1.1em}
            .progress-container{margin:25px 0}
            .progress-bar{height:6px}
            .top-progress-container{height:5px}
            .top-progress-handle{width:12px;height:12px}
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="loading-screen" id="loadingScreen">
            <div class="loading-content">
                <div class="loading-icon">üìÑ</div>
                <div class="loading-text loading">PDF Î°úÎî© Ï§ë</div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressPercentage">0%</div>
                    <div class="progress-status" id="progressStatus"></div>
                </div>
                
                <div class="loading-credit">
                    <div class="loading-credit-title">PDF Flipbook</div>
                    <div class="loading-credit-text">
                        Ïù¥ PDF flipbookÏùÄ Perplexity AIÎ•º ÌôúÏö©Ìï¥<br>
                        <a href="https://welfareact.net" class="loading-credit-link" target="_blank">https://welfareact.net</a>ÏóêÏÑú Ï†úÏûëÌïòÏòÄÏäµÎãàÎã§.
                    </div>
                </div>
            </div>
        </div>

        <div class="viewer-screen" id="viewerScreen">
            <div class="top-progress-container" id="topProgressContainer">
                <div class="top-progress-bar" id="topProgressBar">
                    <div class="top-progress-handle" id="topProgressHandle"></div>
                </div>
            </div>

            <div class="floating-nav left">
                <button class="nav-btn" id="firstBtn" title="Ï≤òÏùåÏúºÎ°ú">‚èÆ</button>
            </div>

            <div class="canvas" id="canvas">
                <div id="flipbook"></div>
            </div>

            <div class="floating-nav right">
                <button class="nav-btn" id="lastBtn" title="ÎÅùÏúºÎ°ú">‚è≠</button>
            </div>

            <div class="touch-zone touch-zone-left" id="touchZoneLeft"></div>
            <div class="touch-zone touch-zone-right" id="touchZoneRight"></div>
            <div class="page-info" id="pageInfo">0/0</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Ïó¨Í∏∞Ïóê PDF URLÏùÑ ÏßÅÏ†ë ÏûÖÎ†•Ìï©ÎãàÎã§.
        const FIXED_PDF_URL = 'https://raw.githubusercontent.com/ThornJSH/flip_PDF/main/flip.pdf';

        let pdfDoc = null;
        let isMobileDevice = false;
        let pdfOrientation = 'portrait';
        let flipbookReady = false;
        let isDragging = false;

        function detectDevice(){
            const ua = navigator.userAgent.toLowerCase();
            isMobileDevice = /android|webos|iphone|ipad|ipod|blackberry|mobile|opera mini/.test(ua);
        }

        function getRenderScale(){
            // PCÎäî scale 2, Î™®Î∞îÏùºÏùÄ scale 1Î°ú Î†åÎçîÎßÅ
            return isMobileDevice ? 1 : 2;
        }

        function getAnimationDuration(){
            // Î™®Î∞îÏùºÏùÄ 300ms, PCÎäî 1000ms
            return isMobileDevice ? 300 : 1000;
        }

        function getElevation(){
            // Î™®Î∞îÏùºÏùÄ ÎÇÆÏùÄ elevation, PCÎäî ÎÜíÏùÄ elevation
            return isMobileDevice ? 10 : 50;
        }

        function showLoading(){
            document.getElementById('loadingScreen').style.display='flex';
            document.getElementById('viewerScreen').classList.remove('show');
        }

        function showViewer(){
            document.getElementById('loadingScreen').style.display='none';
            document.getElementById('viewerScreen').classList.add('show');
        }

        function updateProgress(current, total, status = '') {
            const percentage = Math.round((current / total) * 100);
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressPercentage').textContent = percentage + '%';
            if (status) {
                document.getElementById('progressStatus').textContent = status;
            }
        }

        async function loadFixedPDF(){
            showLoading();
            try {
                updateProgress(0, 100, 'PDF ÌååÏùº Îã§Ïö¥Î°úÎìú Ï§ë...');
                const response = await fetch(FIXED_PDF_URL);
                if(!response.ok) throw new Error('PDF ÌååÏùºÏùÑ Î°úÎìúÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
                
                updateProgress(30, 100, 'PDF ÌååÏùº Î∂ÑÏÑù Ï§ë...');
                const blob = await response.blob();
                const arrayBuffer = await blob.arrayBuffer();
                
                updateProgress(50, 100, 'PDF Î¨∏ÏÑú Ï¥àÍ∏∞Ìôî Ï§ë...');
                pdfDoc = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
                
                updateProgress(60, 100, 'PDF Ï†ïÎ≥¥ Î∂ÑÏÑù Ï§ë...');
                await analyzePDF();
                
                updateProgress(70, 100, 'PDF ÌéòÏù¥ÏßÄ Î†åÎçîÎßÅ Ï§ë...');
                await renderFlipbook();
            } catch (error) {
                console.error(error);
                alert('PDF Î°úÎìú Ïã§Ìå®: '+error.message);
            }
        }

        async function analyzePDF(){
            const numPages = pdfDoc.numPages;
            let landscapeCount = 0;
            for(let i=1;i<=numPages;i++){
                const page = await pdfDoc.getPage(i);
                const vp = page.getViewport({scale:1});
                if(vp.width>vp.height) landscapeCount++;
            }
            pdfOrientation = landscapeCount>numPages/2?'landscape':'portrait';
        }

        async function renderFlipbook(){
            const flipbook=document.getElementById('flipbook');
            flipbook.innerHTML='';
            const numPages=pdfDoc.numPages;
            const scale = getRenderScale();
            
            for(let i=1;i<=numPages;i++){
                const progressPercentage = 70 + ((i / numPages) * 25);
                updateProgress(progressPercentage, 100, `ÌéòÏù¥ÏßÄ Î†åÎçîÎßÅ: ${i}/${numPages}`);
                
                const page=await pdfDoc.getPage(i);
                const vp=page.getViewport({scale:scale});
                const canvas=document.createElement('canvas');
                canvas.width=vp.width;
                canvas.height=vp.height;
                await page.render({canvasContext:canvas.getContext('2d'),viewport:vp}).promise;
                const div=document.createElement('div');
                div.className='page';
                div.innerHTML=`<img src="${canvas.toDataURL('image/png')}" alt="Page ${i}">`;
                flipbook.appendChild(div);
            }
            
            updateProgress(95, 100, 'Flipbook Ï¥àÍ∏∞Ìôî Ï§ë...');
            initFlipbook();
        }

        function initFlipbook(){
            const {width,height,display}=getOptimalSize();
            const duration = getAnimationDuration();
            const elevation = getElevation();
            
            $('#flipbook').turn({
                width,height,display,
                autoCenter:true,
                duration:duration,
                elevation:elevation,
                gradients:true,
                when:{turned:updatePage}
            });
            flipbookReady=true;
            updateProgress(100, 100, 'ÏôÑÎ£å!');
            setTimeout(() => {
                showViewer();
                setupTouchZones();
                setupNavigationButtons();
                setupTopProgressBar();
            }, 300);
            updatePage();
        }

        function getOptimalSize(){
            let width,height,display;
            if(isMobileDevice){
                width=window.innerWidth;height=window.innerHeight;display='single';
            }else{
                display=pdfOrientation==='landscape'?'single':'double';
                if(pdfOrientation==='landscape'){
                    width=Math.min(window.innerWidth*0.98,1500);
                    height=Math.min(window.innerHeight*0.98,800);
                }else{
                    width=Math.min(window.innerWidth*0.95,1100);
                    height=Math.min(window.innerHeight*0.98,900);
                }
            }
            return {width,height,display};
        }

        function setupTouchZones(){
            const touchZoneLeft = document.getElementById('touchZoneLeft');
            const touchZoneRight = document.getElementById('touchZoneRight');
            
            touchZoneLeft.addEventListener('click', function(e){
                e.stopPropagation();
                if(flipbookReady) {
                    $('#flipbook').turn('previous');
                }
            });
            
            touchZoneRight.addEventListener('click', function(e){
                e.stopPropagation();
                if(flipbookReady) {
                    $('#flipbook').turn('next');
                }
            });
        }

        function setupNavigationButtons(){
            document.getElementById('firstBtn').addEventListener('click',function(e){
                e.stopPropagation();
                if(flipbookReady) {
                    $('#flipbook').turn('page', 1);
                }
            });
            
            document.getElementById('lastBtn').addEventListener('click',function(e){
                e.stopPropagation();
                if(flipbookReady) {
                    const totalPages = $('#flipbook').turn('pages');
                    $('#flipbook').turn('page', totalPages);
                }
            });
        }

        function setupTopProgressBar(){
            const container = document.getElementById('topProgressContainer');
            const bar = document.getElementById('topProgressBar');
            const handle = document.getElementById('topProgressHandle');
            
            function calculatePageFromPosition(x){
                const rect = container.getBoundingClientRect();
                const relativeX = Math.max(0, Math.min(x - rect.left, rect.width));
                const percentage = relativeX / rect.width;
                const total = $('#flipbook').turn('pages');
                const page = Math.max(1, Math.min(total, Math.ceil(percentage * total)));
                return page;
            }

            function updateProgressBarPosition(){
                if(!flipbookReady) return;
                const current = $('#flipbook').turn('page');
                const total = $('#flipbook').turn('pages');
                const percentage = (current / total) * 100;
                bar.style.width = percentage + '%';
            }

            function handleProgressClick(e){
                if(isDragging || !flipbookReady) return;
                
                const page = calculatePageFromPosition(e.clientX);
                $('#flipbook').turn('page', page);
            }

            function handleDragStart(e){
                isDragging = true;
                e.preventDefault();
            }

            function handleDragMove(e){
                if(!isDragging || !flipbookReady) return;
                
                const page = calculatePageFromPosition(e.clientX);
                $('#flipbook').turn('page', page);
            }

            function handleDragEnd(){
                isDragging = false;
            }

            // ÎßàÏö∞Ïä§ Ïù¥Î≤§Ìä∏
            container.addEventListener('click', handleProgressClick);
            handle.addEventListener('mousedown', handleDragStart);
            document.addEventListener('mousemove', handleDragMove);
            document.addEventListener('mouseup', handleDragEnd);

            // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏
            handle.addEventListener('touchstart', (e) => {
                isDragging = true;
                e.preventDefault();
            });

            document.addEventListener('touchmove', (e) => {
                if(!isDragging || !flipbookReady) return;
                
                const touch = e.touches[0];
                const page = calculatePageFromPosition(touch.clientX);
                $('#flipbook').turn('page', page);
            });

            document.addEventListener('touchend', () => {
                isDragging = false;
            });

            // ÌéòÏù¥ÏßÄ Î≥ÄÍ≤Ω Ïãú ÌîÑÎ°úÍ∑∏Î†àÏä§ Î∞î ÏóÖÎç∞Ïù¥Ìä∏
            $('#flipbook').on('turned', updateProgressBarPosition);
            updateProgressBarPosition();
        }

        function updatePage(){
            const current=$('#flipbook').turn('page');
            const total=$('#flipbook').turn('pages');
            document.getElementById('pageInfo').textContent=`${current} / ${total}`;
        }

        window.addEventListener('resize',()=>{if(flipbookReady)handleResize()});
        function handleResize(){
            if(!flipbookReady) return;
            const {width,height,display}=getOptimalSize();
            $('#flipbook').turn('size',width,height);
        }

        window.addEventListener('DOMContentLoaded',detectDevice);
        window.addEventListener('load',()=>setTimeout(loadFixedPDF,500));
    </script>
</body>
</html>
